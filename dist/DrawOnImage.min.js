!function(){function t(t,e){var o,r,i,a,n=0,s=function(){o=null,a=t.apply(r,i),o||(r=i=null)},h=function(){var h=(new Date).getTime(),p=e-(h-n);return r=this,i=arguments,p<=0||p>e?(o&&(clearTimeout(o),o=null),n=h,a=t.apply(r,i),o||(r=i=null)):o||(o=setTimeout(s,p)),a};return h.cancel=function(){clearTimeout(o),o=r=i=null},h}var e=function(){function e(t){this.defaultOptions={penColor:"red",penSize:2,penStyle:"solid"},this.idgen=1,this.canDraw=!1,this.graphArray={},this.eventMap={},this.readyStatus=!1,this.options=Object.assign({},this.defaultOptions,t),this.render()}return e.prototype.setOptions=function(t){this.options=Object.assign({},this.defaultOptions,t)},e.prototype.start=function(){this.canDraw=!0,this.imageParentElement.style.cursor="crosshair"},e.prototype.stop=function(){this.canDraw=!1,this.imageParentElement.style.cursor="auto"},e.prototype.addGraphs=function(t){for(var e=t.length-1;e>=0;e--)this.addGraph(t[e])},e.prototype.addGraph=function(t){if(!this.readyStatus){var e=this;return void this.on("ready",function(){e.addGraph(t)})}var o=this.createGraphElement(t.x*this.scale,t.y*this.scale);o.DOI_DATA.w=t.w*this.scale,o.DOI_DATA.h=t.h*this.scale,o.style.width=o.DOI_DATA.w+"px",o.style.height=o.DOI_DATA.h+"px",this.imageParentElement.appendChild(o),this.graphArray[o.DOI_DATA.id]=o,this.fire("addedGraph",this.getGraphData(o))},e.prototype.removeGraph=function(t){var e=this.graphArray[t];e&&(this.imageParentElement.removeChild(e),delete this.graphArray[t],this.fire("removeGraph",this.getGraphData(e)))},e.prototype.clearGraph=function(){for(var t in this.graphArray)this.removeGraph(t)},e.prototype.on=function(t,e){if("ready"===t&&this.readyStatus)return void e.call(this);var o=this.eventMap[t]||[];o.push(e),this.eventMap[t]=o},e.prototype.fire=function(){for(var t=[],e=0;e<arguments.length;e++)t[e-0]=arguments[e];for(var o=this.eventMap[t[0]]||[],r=o.length-1;r>=0;r--){var i=o[r];i.apply(this,Array.prototype.slice.call(t,1,t.length))}},e.prototype.render=function(){var t=this.options.target,e=document.getElementById(t),o=this.imageParentElement=e.parentElement;e.getAttribute("src");"static"===window.getComputedStyle(o).position&&(o.style.position="relative"),this.bindEvent(e,o)},e.prototype.createGraphElement=function(t,e){var o=document.createElement("div");return o.style.position="absolute",o.style.left=t+"px",o.style.top=e+"px",o.style.borderWidth=this.options.penSize+"px",o.style.borderStyle=this.options.penStyle,o.style.borderColor=this.options.penColor,o.className="DOI_GraphElement",o.DOI_DATA={id:this.idgen++,x:t,y:e},this.graphArray[o.DOI_DATA.id]=o,this.fire("createGraph",o),o},e.prototype.drawGraphElement=function(t,e,o){var r=this.wrapWidth,i=this.wrapHeight,a=t.DOI_DATA.x,n=t.DOI_DATA.y,s=function(o){var i=Math.min(Math.abs(a-e),o?r-a:a);t.DOI_DATA.w=i,t.style.width=i+"px",o?(t.style.left="auto",t.style.left=a+"px"):(t.style.left="auto",t.style.right=r-a+"px")},h=function(e){var r=Math.min(Math.abs(n-o),e?i-n:n);t.DOI_DATA.h=r,t.style.height=r+"px",e?(t.style.bottom="auto",t.style.top=n+"px"):(t.style.top="auto",t.style.bottom=i-n+"px")};s(e>=a),h(o>=n),this.fire("drawing",this.getGraphData(t))},e.prototype.getGraphData=function(t){var e={},o=this.scale,r=t.style,i=t.DOI_DATA;return e.id=i.id,e._node=t,e.draw={scale:o,x:i.x,y:i.y,w:i.w,h:i.h,directionX:"auto"===r.left?"right":"left",directionY:"auto"===r.top?"bottom":"top"},e.w=Math.floor(i.w/o),e.h=Math.floor(i.h/o),"auto"===r.left?e.x=Math.floor(i.x/o-e.w):e.x=Math.floor(i.x/o),"auto"===r.top?e.y=Math.floor(i.y/o-e.h):e.y=Math.floor(i.y/o),e},e.prototype.bindEvent=function(e,o){var r,i,a,n=this,s=!1,h=function(t,e){return t.pageX-(e.left+document.body.scrollLeft)},p=function(t,e){return t.pageY-(e.top+document.body.scrollTop)};o.addEventListener("mousedown",function(t){if(t.preventDefault(),t.stopPropagation(),1===t.which&&n.canDraw&&!s){var l=e.getBoundingClientRect();s=!0,r=h(t,l),i=p(t,l),a=n.createGraphElement(r,i),o.appendChild(a)}}),document.addEventListener("mousemove",t(function(t){if(t.preventDefault(),t.stopPropagation(),s){var o=e.getBoundingClientRect(),r=h(t,o),i=p(t,o);n.drawGraphElement(a,r,i)}},28)),document.addEventListener("mouseup",function(t){t.preventDefault(),t.stopPropagation(),s&&(s=!1,n.fire("addedGraph",n.getGraphData(a)))}),e.addEventListener("load",function(t){n.readyStatus=!0,n.resetDrawConfig(e,o)}),e.complete&&(this.readyStatus=!0,this.resetDrawConfig(e,o));var l;window.addEventListener("resize",function(t){l&&clearTimeout(l),l=setTimeout(function(){n.onWindowResize(e,o)},100)})},e.prototype.onWindowResize=function(t,e){var o=t.offsetWidth,r=o/this.wrapWidth;for(var i in this.graphArray){var a=this.graphArray[i],n=a.DOI_DATA;n.x=Math.floor(parseInt("auto"===a.style.left?a.offsetRight:a.offsetLeft)*r),n.y=Math.floor(parseInt("auto"===a.style.top?a.offsetBottom:a.offsetTop)*r),n.h=Math.floor(+a.offsetHeight*r),n.w=Math.floor(+a.offsetWidth*r),a.style.width=n.w+"px",a.style.height=n.h+"px","auto"===a.style.left?a.style.right=n.x+"px":a.style.left=n.x+"px","auto"===a.style.top?a.style.bottom=n.y+"px":a.style.top=n.y+"px"}this.resetDrawConfig(t,e)},e.prototype.resetDrawConfig=function(t,e){this.wrapWidth=t.offsetWidth,this.wrapHeight=t.offsetHeight,this.scale=+this.wrapWidth/t.naturalWidth},e}();window.DrawOnImage=e,"function"!=typeof Object.assign&&!function(){Object.assign=function(t){"use strict";if(void 0===t||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),o=1;o<arguments.length;o++){var r=arguments[o];if(void 0!==r&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}}()}();